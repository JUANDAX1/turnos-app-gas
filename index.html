<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style><?!= include('styles.html'); ?></style>
</head>
<body>

  <div class="login-overlay" id="loading-screen">
    <div class="login-card">
      <h2>Sistema de N√≥mina</h2>
      <p>Verificando acceso...</p>
    </div>
  </div>

  <div class="app-container" id="app-container">
    <nav class="sidebar">
      <div class="sidebar-header">
        <h1>Sistema de N√≥mina</h1>
      </div>
      <ul class="nav-menu">
        <li class="nav-item" id="nav-dashboard"><a class="nav-link" onclick="showTab('dashboard', this)"><span class="nav-icon">üìä</span>Dashboard</a></li>
        <li class="nav-item" id="nav-asistencia"><a class="nav-link" onclick="showTab('asistencia', this)"><span class="nav-icon">‚úÖ</span>Registrar Asistencia</a></li>
        <li class="nav-item" id="nav-colaboradores"><a class="nav-link" onclick="showTab('colaboradores', this)"><span class="nav-icon">üßë‚Äçüíº</span>Colaboradores</a></li>
        <li class="nav-item" id="nav-nomina"><a class="nav-link" onclick="showTab('nomina', this)"><span class="nav-icon">üí∞</span>Calcular N√≥mina</a></li>
        <li class="nav-item" id="nav-consultas"><a class="nav-link" onclick="showTab('consultas', this)"><span class="nav-icon">üîç</span>Consultar Asistencia</a></li>
        <li class="nav-item" id="nav-proyectos"><a class="nav-link" onclick="showTab('proyectos', this)"><span class="nav-icon">üèóÔ∏è</span>Registrar Proyectos</a></li>
        <li class="nav-item" id="nav-configuracion"><a class="nav-link" onclick="showTab('configuracion', this)"><span class="nav-icon">‚öôÔ∏è</span>Configuraci√≥n</a></li>
      </ul>
    </nav>

    <div class="main-content">
        <div id="dashboard" class="tab-content">
        <div class="content-header"><h2>Dashboard General</h2></div>
        <div class="content-body">
          <div class="stats-grid">
            <div class="stat-card"><div class="stat-value" id="stat-colaboradores">0</div><div class="stat-label">Colaboradores Activos</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-asistencia-hoy">0</div><div class="stat-label">Asistencias Hoy</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-ausencias-hoy">0</div><div class="stat-label">Ausencias Hoy</div></div>
            <div class="stat-card"><div class="stat-value" id="stat-nomina-pendiente">0</div><div class="stat-label">N√≥minas Pendientes</div></div>
          </div>
        </div>
      </div>

      <div id="asistencia" class="tab-content">
        <div class="content-header"><h2>Registro Diario de Asistencia</h2></div>
        <div class="content-body">
          
          <div class="card">
            <div class="card-header">
              Registrar Asistencia para el D√≠a: 
              <input type="date" id="fecha-asistencia" onchange="cargarVistaAsistencia()" style="margin-left: 10px; font-size: 1rem; padding: 5px; width: 180px;">
            </div>
            <div class="card-body">
              <div class="table-container" id="asistencia-input-grid">
                </div>
              <div class="actions" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="guardarAsistencias()">Cargar Asistencias</button>
              </div>
              <div id="msgAsistenciaGrid"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Registros Cargados Hoy</div>
            <div class="card-body">
              <div class="table-container" id="asistencia-results-table">
                </div>
            </div>
          </div>

        </div>
      </div>

      <div id="colaboradores" class="tab-content">
        <div class="content-header"><h2>Gesti√≥n de Colaboradores</h2></div>
        <div class="content-body">
          <div class="card">
            <div class="card-header">Registrar Nuevo Colaborador</div>
            <div class="card-body">
              <form id="formColaborador" onsubmit="registrarColaborador(event)">
                <div class="form-grid">
                  <div class="form-group"><label for="idColaborador">ID / RUT / C√©dula *</label><input id="idColaborador" type="text" required></div>
                  <div class="form-group"><label for="nombreColaborador">Nombre Completo *</label><input id="nombreColaborador" type="text" required></div>
                  <div class="form-group"><label for="cargoColaborador">Cargo</label><input id="cargoColaborador" type="text"></div>
                  <div class="form-group"><label for="deptoColaborador">Departamento</label><input id="deptoColaborador" type="text"></div>
                  <div class="form-group"><label for="fechaIngreso">Fecha de Ingreso *</label><input id="fechaIngreso" type="date" required></div>
                  <div class="form-group"><label for="sueldoBase">Sueldo Base *</label><input id="sueldoBase" type="number" step="1000" required></div>
                </div>
                <div class="actions">
                  <button type="submit" class="btn btn-success">Registrar Colaborador</button>
                  <button type="button" class="btn btn-secondary" onclick="document.getElementById('formColaborador').reset(); setDefaultDates();">Limpiar</button>
                </div>
              </form>
              <div id="msgColaborador"></div>
            </div>
          </div>
          <div class="card">
             <div class="card-header">Lista de Colaboradores</div>
             <div class="card-body">
                <div class="actions"><button class="btn" onclick="mostrarColaboradores()">Actualizar Lista</button></div>
                <div id="loadingColaboradores" class="loading">Cargando...</div>
                <div class="table-container" id="tablaColaboradores"></div>
             </div>
          </div>
        </div>
      </div>
      
      <div id="nomina" class="tab-content">
        <div class="content-header"><h2>C√°lculo de Pre-N√≥mina</h2></div>
        <div class="content-body">
          <div class="card">
            <div class="card-header">Seleccionar Per√≠odo de C√°lculo</div>
            <div class="card-body">
              <form id="formNomina" onsubmit="solicitarCalculoNomina(event)" class="form-grid">
                <div class="form-group">
                  <label for="nomina-mes">Mes</label>
                  <select id="nomina-mes" required>
                    <option value="1">Enero</option>
                    <option value="2">Febrero</option>
                    <option value="3">Marzo</option>
                    <option value="4">Abril</option>
                    <option value="5">Mayo</option>
                    <option value="6">Junio</option>
                    <option value="7">Julio</option>
                    <option value="8">Agosto</option>
                    <option value="9">Septiembre</option>
                    <option value="10">Octubre</option>
                    <option value="11">Noviembre</option>
                    <option value="12">Diciembre</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="nomina-anio">A√±o</label>
                  <input type="number" id="nomina-anio" required min="2020" max="2040">
                </div>
                <div class="form-group" style="justify-content: flex-end;">
                  <button type="submit" class="btn btn-primary" style="width: auto;">Calcular N√≥mina</button>
                </div>
              </form>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Resultados del C√°lculo</div>
            <div class="card-body">
              <div id="loadingNomina" class="loading">Calculando, por favor espera...</div>
              <div class="table-container" id="resultadosNomina">
                <div class="message">Selecciona un mes y a√±o para ver los resultados.</div>
              </div>
            </div>
          </div>
        </div>
      </div>

<div id="consultas" class="tab-content">
        <div class="content-header"><h2>Consultar Historial de Asistencia</h2></div>
        <div class="content-body">
          <div class="card">
            <div class="card-header">Filtros de B√∫squeda</div>
            <div class="card-body">
              <form id="formConsulta" onsubmit="consultarAsistencias(event)" class="form-grid">
                <div class="form-group">
                  <label for="consulta-fecha-desde">Desde</label>
                  <input type="date" id="consulta-fecha-desde" required>
                </div>
                <div class="form-group">
                  <label for="consulta-fecha-hasta">Hasta</label>
                  <input type="date" id="consulta-fecha-hasta" required>
                </div>
                <div class="form-group">
                  <label for="consulta-colaborador">Colaborador</label>
                  <select id="consulta-colaborador"></select>
                </div>
                <div class="form-group" style="justify-content: flex-end;">
                  <button type="submit" class="btn btn-primary" style="width: auto;">Buscar</button>
                </div>
              </form>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Resultados</div>
            <div class="card-body">
              <div id="loadingConsulta" class="loading">Buscando...</div>
              <div class="table-container" id="resultados-consulta"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="login-overlay" id="modal-edicion" style="display: none;">
        <div class="login-card" style="max-width: 500px;">
          <h2>Editar Registro de Asistencia</h2>
          <form id="form-edicion" onsubmit="guardarCambiosAsistencia(event)">
            <input type="hidden" id="edit-idRegistro">
            <div class="form-group">
              <label for="edit-estado">Nuevo Estado</label>
              <select id="edit-estado" required></select>
            </div>
            <div class="form-group">
              <label for="edit-asignacion">Nueva Asignaci√≥n</label>
              <select id="edit-asignacion" required></select>
            </div>
            <div class="form-group">
              <label for="edit-observaciones">Nuevas Observaciones</label>
              <textarea id="edit-observaciones" rows="3"></textarea>
            </div>
            <div class="actions">
              <button type="submit" class="btn btn-success">Guardar Cambios</button>
              <button type="button" class="btn btn-secondary" onclick="cerrarModalEdicion()">Cancelar</button>
            </div>
          </form>
          <div id="msgEdicion" style="margin-top: 15px;"></div>
        </div>
      </div>

      <div id="proyectos" class="tab-content">
        <div class="content-header"><h2>Gesti√≥n de Proyectos</h2></div>
        <div class="content-body">
          <div class="card">
            <div class="card-header">Registrar Nuevo Proyecto</div>
            <div class="card-body">
              <form id="formProyecto" onsubmit="registrarProyecto(event)">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="project_code">C√≥digo del Proyecto *</label>
                    <input id="project_code" type="text" required>
                  </div>
                  <div class="form-group">
                    <label for="project_name">Nombre del Proyecto *</label>
                    <input id="project_name" type="text" required>
                  </div>
                  <div class="form-group">
                    <label for="registration_date">Fecha de Registro *</label>
                    <input id="registration_date" type="date" required>
                  </div>
                  <div class="form-group">
                    <label for="project_address">Direcci√≥n</label>
                    <input id="project_address" type="text">
                  </div>
                  <div class="form-group">
                    <label for="project_georeference">Georeferencia</label>
                    <input id="project_georeference" type="text">
                  </div>
                  <div class="form-group">
                    <label for="project_contact">Contacto</label>
                    <input id="project_contact" type="text">
                  </div>
                  <div class="form-group">
                    <label for="project_observation">Observaciones</label>
                    <textarea id="project_observation" rows="3"></textarea>
                  </div>
                </div>
                <div class="actions">
                  <button type="submit" class="btn btn-success" id="btnSubmitProject">Registrar Proyecto</button>
                  <button type="button" class="btn btn-secondary" id="btnCancelEdit" style="display: none;" onclick="cancelarEdicion()">Cancelar Edici√≥n</button>
                </div>
              </form>
              <div id="msgProyecto"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>Lista de Proyectos</span>
                <div class="search-container">
                  <input type="text" id="searchProyectos" placeholder="Buscar proyectos..." onkeyup="buscarProyectos(this.value)">
                  <span class="search-icon">üîç</span>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div id="loadingProyectos" class="loading">Cargando...</div>
              <div class="table-container" id="tablaProyectos"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="configuracion" class="tab-content">
        <div class="content-header"><h2>Configuraci√≥n del Sistema</h2></div>
        <div class="content-body">
          <div class="card">
            <div class="card-header">Herramientas</div>
            <div class="card-body">
              <div class="actions">
                <button class="btn btn-success" onclick="inicializarSistema()">Inicializar / Validar Hojas</button>
              </div>
              <div id="msgConfig"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script><?!= include('javascript.html'); ?></script>
</body>
</html>